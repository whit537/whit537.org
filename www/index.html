import datetime
import os
import re

import tree


title = "www.whit537.org"
byline = None
published = None
certified = True

posts = tree.db.find( { "published": {"$exists": True}}
                    , sort=[("published", -1)]
                     )

years = []
for post in posts:
    year = post['published'].split('-')[0]
    if not year:
        year = "Ongoing"
    if not years or (year != years[-1][0]):
        years.append([year, []])
    years[-1][1].append(post)

years.insert(0, years.pop())
years[0][1].append({ "_id": "https://www.gittip.com/"
                   , "title": "Gittip - Inspiring Generosity"
                    })
years[0][1].append({ "_id": "http://aspen.io/"
                   , "title": "Aspen Web Framework"
                   })
years[0][1].sort(key=lambda d: d['title'])



{% extends "base.html" %}
{% block nav %}
{% end %}
{% block content %}
    {% for year, posts in years %}
        <a name="{{ year }}"></a>
        <h3 class="year">
            <a href="/#{{ year }}">#</a>{{ year }}
        </h3>
        <div class="posts">
        {% for post in posts %}
            <a href="{{ post['_id'] }}">{{ post['title'] }}</a>
        {% end %}
        &nbsp;
        </div>
    {% end %}
{% end %}
