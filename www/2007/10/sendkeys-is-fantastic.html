title = "SendKeys is fantastic"
published = "2007-10-25T14:46:00.000-04:00"
updated = "2011-04-10T09:52:45.214-04:00"
^L
^L
{% extends "blag.html" %}
{% block content %}
<a href="http://www.acn-us.org/">We</a> use <a href="http://www.acstechnologies.com/">a database</a> that doesn't let me delete multiple entries at once. ACK. Since the import mechanism is likewise crusty, I've ended up with several hundred new records that I want to back out. Shame on me for not being more careful with backups, but now I need in fact to delete hundreds of records at once.<br /><br />This is a perfect use case for a GUI automator, of which there are several for Python on Windows. The one I've <a href="http://blag.whit537.org/2007/01/fun-with-screen-scraping.html">tried before</a> is <a href="http://www.openqa.org/pywinauto/">pywinauto</a> (good list there of the others). I got it to work, but it felt as dirty as Windows itself. Consider this snippet from my pywinauto <a href="http://static.whit537.org/2007/get-newsletters.py">script</a>, which saves a series of web pages opened as tabs in Firefox:<br /><pre>app = Application().start_(FIREFOX % url)<br />time.sleep(3)<br />if not app.windows_(): # Firefox wasn't already running; we launched it<br />app = Application().connect_(title_re=".* - Mozilla Firefox")<br />firefox = app.window_(title_re=".* - Mozilla Firefox")<br /><br />firefox.TypeKeys("%FA") # File -> Save As<br />while app.SaveAs.FileNameEdit.TextBlock() != save_as:<br />app.SaveAs.FileNameEdit.SetEditText(save_as)<br />app.SaveAs.TypeKeys("%S") # "Save" button<br />firefox.TypeKeys("%FC") # File -> Close Tab</pre><a href="http://www.rutherfurd.net/python/sendkeys/index.html">SendKeys</a> is much more intuitive. It always inputs to the active window, so you don't have to mess with app and window objects. Instead, you spend your time in a neat mini-language that closely mirrors the process of manually manipulating Windows. The documentation is concise and clear, and the module has no additional dependencies, not even ctypes!<br /><br />Here is the above, ported to SendKeys (% is the <span style="font-style: italic;">alt</span> modifier in both scripts):<br /><pre>import SendKeys<br /><br />SendKeys.SendKeys("""<br /><br />    {LWIN}rFirefox.exe{ENTER}   {PAUSE 3}<br />    %fa                         {PAUSE .5}<br />    New{SPACE}filename.html     {PAUSE 1}<br />    %s                          {PAUSE 1}<br />    %fc                         {PAUSE 1}<br /><br />""", pause=0.1)</pre>GUI automation is like comedy: it's all in the timing. Watch both micro-timings and longer application-blocking actions. "Instantaneous" for a human means <a href="http://www.useit.com/papers/responsetime.html">less than one-tenth of a second</a>, but not for a computer, and you need to account for the micro-seconds between manual keystrokes: SendKeys' global <code>pause</code> argument is therefore a great touch. With actions that actually block the application, script for the worst case, because once a script gets out of sync with the current Windows state, there's no going back. So if a certain action takes between 1 and 2 seconds to complete, give it 2.25. A third of the work is getting the keystrokes right, the rest is tweaking the timing to be as fast as possible while observing zero tolerance for error.<br /><br />One trick is to prep as much as you can, like on a cooking show. For example, I needed to type in a reason for each record I was deleting. Having SendKeys type this for me takes maybe half a second, but putting it in the paste buffer and having SendKeys merely paste it for me is much closer to instantaneous. A half-second per iteration is over 8 minutes on 1000 iterations.<br /><br />SendKeys could easily be developed into an outright shell, passing in automation scripts on the command line. You would need a mechanism for specifying the additional arguments like <code>pause</code> (mime-style headers would suffice), and you would also want a commenting capability (just add # to the list of special characters). All in all, though, I highly recommend it when you need to hack together a GUI automation script.<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/36506138-7857794327852687796?l=blag.whit537.org' alt='' /></div>
{% end %}
