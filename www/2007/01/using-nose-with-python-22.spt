title = "Using nose with Python 2.2"
published = "2007-01-04T15:39:00.000-05:00"
updated = "2011-04-10T09:52:45.373-04:00"
[---]
[---] text/html
{% extends "base.html" %}
{% block content %}
If your public Python project isn't backwards-compatible to Python 1.5, it should at least be compatible back to Python 2.2. I pick that milestone because of a legend that it's what Google  uses.<br /><br />I've got a few <a href="http://www.zetadev.com/software/lib537/">public</a> <a href="http://www.zetadev.com/software/aspen/">Python</a> <a href="http://tech.whit537.org/2007/01/dewey-think-google-desktop-for-python.html">projects</a>, and I've grown to like <a href="http://somethingaboutorange.com/mrl/projects/nose/">nose</a> for testing them. However, nose is decidedly not backwards-compatible to Python 2.2. Here's a recipe to make it so:<br /><ol><li>You won't be able to install nose using setup.py, so just export <a href="http://python-nose.googlecode.com/svn/trunk/nose/">the package</a> onto your PYTHONPATH.<br /></li><li>Find all the files that use <a href="http://docs.python.org/ref/yield.html">yield</a>, and add <a href="http://www.python.org/dev/peps/pep-0255/">from __future__ import generators</a> at the top.</li><li>Fill out your local library with <a href="http://svn.python.org/projects/python/tags/r25/Lib/logging/">logging</a>, <a href="http://svn.python.org/projects/python/tags/r25/Lib/optparse.py">optparse</a>, <a href="http://svn.python.org/projects/python/tags/r25/Lib/sets.py">sets</a> and <a href="http://svn.python.org/projects/python/tags/r25/Lib/textwrap.py">textwrap</a> from the standard library.</li><li>Then get <a href="http://svn.python.org/projects/sandbox/trunk/setuptools/pkg_resources.py">pkg_resources</a>. You'll need to add the generators import, then hack out the <a href="http://docs.python.org/lib/module-zipimport.html">zipimport</a> dependency (it's a C extension; if you need zip importing then you'll have to compile it), and lastly add a couple of <a href="http://www.python.org/dev/peps/pep-0302/">import hooks</a>. Here's <a href="http://tech2.whit537.org/2007/pkg_resources.py">my version</a>.</li><li>Lastly, create an executable script on your PATH  named <span style="font-style: italic;">nosetests</span>, with these contents:</li></ol><pre style="margin-left: 4em;">#!/usr/bin/env python<br />import nose.core<br />nose.core.main()</pre>Now you can run nosetests on your Python 2.2 projects. Mine fail pretty quick, so there may yet be 2.2-compatibility bugs hidden in nose. If/when I find them, I'll backlink here.<br /><br /><span style="font-weight: bold;">Update:</span> I've filed <a href="http://code.google.com/p/python-nose/issues/detail?id=23">a bug+patch</a> regarding #2 above.<br /><span style="font-weight: bold;">Update:</span> Patch committed; watch for it in nose 0.9.2. Thanks Jason!<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/36506138-2435313225826349453?l=blag.whit537.org' alt='' /></div>
{% endblock %}
