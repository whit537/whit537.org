title = "One directory, 500,000 files"
published = "2007-02-06T13:30:00.000-05:00"
updated = "2011-04-10T09:52:45.341-04:00"
^L


^L
{% extends "blag.html" %}
{% block content %}

<p>I have a thing for the filesystem: I really want to use it instead of a
relational database. Part of this is wanting to achieve <a
href="http://cm.bell-labs.com/cm/cs/who/dmr/cacm.html">UNIX zen</a>, wanting
all my data in the same space, not in some cyber-cyberspace like
<code>mysql></code> or <code>whit537=#</code>. Part of it is wanting to install
and admin less software. Part of it is wanting to avoid regexp dispatch hacks:
URLs are hierarchical unique ids, the filesystem is hierarchical, what's the
problem?</p>

<p>One problem is that the filesystem isn't ACID. Answer: Subversion. Another
is that it can't be queried. <a
    href="http://tech.whit537.org/2007/01/dewey-think-google-desktop-for-python.html">Working
    on it</a>.<br /><br />The question nagging me now is scalability. I know
you're <a href="http://gettingreal.37signals.com/ch04_Scale_Later.php">not
    supposed to think about that</a> until it happens, but you're also not
supposed to use the filesystem for "real" data storage in the first place. So
out of curiosity as much as fear: let's say you use the filesystem for storage,
and that as part of your app you have a <code>users/</code> directory, which
contains one file per user. Now let's say you balloon to 500,000 users. How
screwed are you?</p>

<p>To find out, I'll start by creating a directory with 500,000 empty files in
it. Here we go ...<br /><pre>$ mkdir files<br />$ cat - > test.py<br />for i in
range(500000):<br />  open('files/%d' % i, 'w')<br />$ python test.py<br
/></pre>This has been running for 15+ CPU minutes so far. I have about 20
million inodes available on my system, so that won't be the problem. It will
get more interesting when I try to load these into Subversion, and then again
when I try to query themâ€”<code>ls(1)</code> just isn't going to cut it.<br
/><br />Stay tuned ...<br /><br /><b>Update:</b> <a
    href="http://tech.whit537.org/2007/02/one-repo-27923-nodes.html">One repo,
    27,923 nodes</a><div class="blogger-post-footer"><img width='1' height='1'
    src='https://blogger.googleusercontent.com/tracker/36506138-8592604158145852157?l=blag.whit537.org'
    alt='' /></div>

{% end %}
