title = "How to hack on Google Maps"
published = "2007-07-03T08:23:00.002-04:00"
updated = "2011-04-10T09:52:45.287-04:00"
[---]
[---] text/html
{% extends "base.html" %}
{% block content %}
<p>In working on improvements to <a href="http://www.acn-us.org/local/">our embedded Google Map</a>, I found that I needed functionality on the server-side that Google provides as <a href="http://code.google.com/apis/maps/documentation/reference.html#GMercatorProjection">part of its javascript API</a> (I'm looking at <span style="font-family:courier new;">fromLatLngToPixel</span>). The obvious answer is to port the javascript function to Python, but   Google obfuscates its javascript. I decided to try unobfuscating their code to see if that was easier than learning trig. It turned out to be the right way to go, because the function as written requires constants specific to Google Maps that I would either have needed to compute myself, or to unobfuscate anyway. (BTW, these constants seem to indicate that Google thinks it will have 31 zoom levels some day. They currently only use up to <a href="http://maps.google.com/maps?f=q&amp;hl=en&amp;amp;amp;amp;amp;amp;geocode=&amp;ie=UTF8&amp;om=1&amp;ll=40.609408,-80.224442&amp;spn=0.001134,0.001802&amp;t=k&amp;z=19">level 19</a> [0-indexed]. Level 30 is going to be really hi-res!)</p><p>Now in fact, unobfuscating one function wasn't that hard. First, I copied two of Google's scripts to my server. You need <a href="http://maps.google.com/maps?file=api&amp;v=2">the first one</a> they <a href="http://code.google.com/apis/maps/documentation/#The_Hello_World_of_Google_Maps">have you link to</a>, and also the script that the first one loads (this is the one in the upper-right box on <a href="http://mapki.com/wiki/Main_Page">Mapki</a>). Using my text editor, I added line breaks to both after semicolons and end-braces. The first script isn't actually obfuscated, just minified, and it's not that long, so I actually went on to <a href="http://javascript.about.com/library/blformat.htm">format</a> the whole thing. Once I could read the first script, I only had to make two changes to it in order for both scripts to work from my server: I had to tweak the call to the second script from the first so it pointed to my version (in GLoadMapsScript at the bottom), and I had to comment out the key validation check (in GLoad). Then I linked to <a href="http://static.whit537.org/2007/google-maps.js">my version of the first script</a> from my HTML page, and it worked like normal! Blam.</p><p>With Google's scripts under the reigns, <a href="http://www.getfirebug.com/">Firebug</a>'s <a href="http://www.getfirebug.com/js.html">debugger</a> made it trivial to isolate the function I wanted. I triggered a call to the function in a third script, and placed Firebug's special <span style="font-family:courier new;">debugger</span> keyword before the function call. That gave me a runtime debugger with which to simply step into Google's function. And with the script on my own server, I could then isolate the function in my text editor, format it, and poke it until it made sense. And once it made sense, it was a simple matter to <strike><a href="http://static.whit537.org/2007/gmerc.py">translate it to Python</a></strike>.</p><p>Now, mind you, I'm not opposed to learning trig. But when the exact function I need is already written, I'll definitely try a little hackery if it can save me some effort. And the effort I saved, I've spent on this blog post. So there. You win.</p><p><span style="font-size:85%;"><span style="font-style: italic;">P.S. As far as I can tell I'm not violating the </span><a style="font-style: italic;" href="http://code.google.com/apis/maps/terms.html">terms of service</a><span style="font-style: italic;">. Please <a href="mailto:chad@zetaweb.com">tell me</a> if I am. I am not a lawyer.</span></span></p><br /><p><b>UPDATE:</b> Actually, this is really bad form, isn't it? Google has not at all given me the right to port their obfuscated JavaScript to Python. I'm sorry. I've removed the Python script linked above. Should I take down this whole post?</p><div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/36506138-808722777950140799?l=blag.whit537.org' alt='' /></div>
{% endblock %}
