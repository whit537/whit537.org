title = "How to evolve a stylesheet"
published = "2007-05-31T11:55:00.000-04:00"
updated = "2011-04-10T09:52:45.308-04:00"
^L
^L
{% extends "blag.html" %}
{% block content %}
An HTML page depends on images, stylesheets, and javascripts. These resources don't change often, and so browsers and proxies ought to cache them fairly aggressively. But when you do make a change, you can get burned: your new markup will probably look very bad styled with your old, cached CSS. So how do you gracefully evolve a stylesheet? It's easy:<br /><ol><li><span style="font-weight: bold;">Change the URL every time.</span> I use names like <span style="font-style: italic;">main.1.css</span>, and I increment the integer with each roll-out. Don't forget to change the links in your dependent files. Now anyone who gets the new markup will also get the new dependencies.<br /><br /></li><li><span style="font-weight: bold;">Keep old versions around.</span> If someone has your old HTML cached, then they will need the old dependencies as well. Leave them around for a year or so.<br /></li></ol>Follow these two practices, and you'll be safe from cache bite-back.<br /><br />You'll be encouraged to know that <a href="http://www.thinkvitamin.com/features/webapps/serving-javascript-fast">flickr uses similar techniques</a> (see esp. "Caching is your <span style="font-style: italic;">best</span> friend"), though their setup is more complex. Most of their gymnastics are to avoid manually changing links to dependent files. First: how many do they really have, I wonder? Second, there are other ways to automate this. Here's a little command-line recipe using <a style="font-family: courier new;" href="http://www.freebsd.org/cgi/man.cgi?query=find&manpath=FreeBSD+6.2-RELEASE">find</a> and <a href="http://www.freebsd.org/cgi/man.cgi?query=sed&amp;manpath=FreeBSD+6.2-RELEASE"><span style="font-family:courier new;">sed</span></a>, which does a regexp replacement in all .html files below the current directory:<br /><pre style="padding-left: 2em;">find . -name \*.html \<br />       -exec sed -e 's/main\.1\.css/main\.2\.css/g' \<br />                 -i '' {} \;</pre>(It's a good idea to make sure your work is checked in before running this command, because then it's easier to revert if you screw up.)<br /><br />Also, I don't see that flickr handles case #2 above, because they use mod_rewrite to always serve only the latest resource regardless of version number. Don't users still need the old stylesheet until their cache of the HTML expires?<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/36506138-1250195980424132353?l=blag.whit537.org' alt='' /></div>
{% end %}
