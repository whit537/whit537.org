title = "Calculating distance from KML"
published = "2007-05-26T07:50:00.001-04:00"
updated = "2011-04-10T09:52:45.314-04:00"
[---]
[---] text/html
{% extends "base.html" %}
{% block content %}
I'd like to calculate the distance of <a href="http://blag.whit537.org/2007/05/harmony-twp-5k-road-route.html">my running route</a> from its Google Maps <a href="http://maps.google.com/maps/ms?ie=UTF8&hl=en&amp;msa=0&msid=100859649110530092918.00000112c4ee6f149e38d&amp;amp;amp;amp;amp;amp;amp;t=h&z=16&amp;om=1">representation</a>.<br /><br />The first step is to get the map in a programmable format, namely, <a href="http://code.google.com/apis/kml/documentation/">KML</a>. On <a href="http://maps.google.com/maps/ms?ie=UTF8&hl=en&amp;msa=0&msid=100859649110530092918.00000112c4ee6f149e38d&amp;amp;amp;amp;amp;t=h&z=16&amp;om=1">the map</a>, click the "<a href="http://maps.google.com/maps/ms?ie=UTF8&hl=en&amp;om=1&msa=0&amp;output=nl&msid=100859649110530092918.00000112c4ee6f149e38d"><img src="http://maps.google.com/mapfiles//ms/view_as_kml.png" /> KML</a>" link to download the map in this XML format. The downloaded file contains a link to <a href="http://maps.google.com/maps/ms?ie=UTF8&amp;amp;amp;amp;amp;hl=en&om=1&amp;msa=0&msid=100859649110530092918.00000112c4ee6f149e38d&amp;output=kml">the "real" KML file</a>. At first I got an <span style="font-style: italic;">{errorText:"Unable to contact server."}</span> error from this second link, and I had to open the first KML file in Google Earth, then save the real info to KML from there. Now this direct link is working though.<br /><br />Once you have the KML file, you need to parse out the coordinates of the line you're interested in, and then sum the distances of each segment of the line. Here's <a href="https://www.zetadev.com/svn/public/utils/calc-distance.py">an initial attempt</a>. I've assumed a square geometry since the distances are small, though in actuality the math is <a href="https://answers.google.com/answers/threadview?id=577262">more complicated</a>.<br /><br />But we're not done yet. I measured this route at 5km/3.1m in my car, but my script tells me that it is only 4.07km/2.53m long. Here are some possible reasons for the discrepancy:<br /><ul><li>A square geometry won't work even at this scale.</li><li>The variations in elevation are significant (Google Maps only has lat/lng).</li><li>There is some other bug in my script.</li><li>I cut corners significantly closer when running than driving.<br /></li><li>My car's odometer is inaccurate.</li></ul>Anything else I could be missing?<div class="blogger-post-footer"><img width='1' height='1' src='https://blogger.googleusercontent.com/tracker/36506138-2713054576959202464?l=blag.whit537.org' alt='' /></div>
{% endblock %}
